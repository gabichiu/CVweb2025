<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Admin Panel</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icon components
    const Save = ({ size = 20 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="save" style={{ width: size, height: size }}></i>;
    };

    const Download = ({ size = 20 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="download" style={{ width: size, height: size }}></i>;
    };

    const Upload = ({ size = 20 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="upload" style={{ width: size, height: size }}></i>;
    };

    const Eye = ({ size = 20 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="eye" style={{ width: size, height: size }}></i>;
    };

    const Plus = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="plus" style={{ width: size, height: size }}></i>;
    };

    const Trash = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="trash-2" style={{ width: size, height: size }}></i>;
    };

    function AdminPanel() {
      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [activeSection, setActiveSection] = useState('personal');

      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        // First check localStorage
        const savedData = localStorage.getItem('resumeData');
        if (savedData) {
          setData(JSON.parse(savedData));
          setLoading(false);
          return;
        }

        // Otherwise load from JSON file
        try {
          const response = await fetch('resume-data.json');
          const jsonData = await response.json();
          setData(jsonData);
        } catch (error) {
          console.error('Error loading resume data:', error);
          alert('Failed to load resume data. Please make sure resume-data.json is in the same folder.');
        }
        setLoading(false);
      };

      const saveToLocalStorage = () => {
        localStorage.setItem('resumeData', JSON.stringify(data));
        alert('Changes saved to browser storage!');
      };

      const downloadJSON = () => {
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'resume-data.json';
        link.click();
        URL.revokeObjectURL(url);
        alert('JSON file downloaded!');
      };

      const loadFromJSON = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const jsonData = JSON.parse(event.target.result);
                setData(jsonData);
                alert('Data loaded successfully!');
              } catch (error) {
                alert('Error parsing JSON file: ' + error.message);
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      };

      const updateField = (path, value) => {
        setData(prev => {
          const newData = { ...prev };
          const keys = path.split('.');
          let current = newData;

          for (let i = 0; i < keys.length - 1; i++) {
            current[keys[i]] = { ...current[keys[i]] };
            current = current[keys[i]];
          }

          current[keys[keys.length - 1]] = value;
          return newData;
        });
      };

      const updateArrayItem = (arrayPath, index, value) => {
        setData(prev => {
          const newData = { ...prev };
          const keys = arrayPath.split('.');
          let current = newData;

          for (let i = 0; i < keys.length - 1; i++) {
            current[keys[i]] = { ...current[keys[i]] };
            current = current[keys[i]];
          }

          const arrayKey = keys[keys.length - 1];
          current[arrayKey] = [...current[arrayKey]];
          current[arrayKey][index] = value;

          return newData;
        });
      };

      const addArrayItem = (arrayPath, defaultValue) => {
        setData(prev => {
          const newData = { ...prev };
          const keys = arrayPath.split('.');
          let current = newData;

          for (let i = 0; i < keys.length - 1; i++) {
            current[keys[i]] = { ...current[keys[i]] };
            current = current[keys[i]];
          }

          const arrayKey = keys[keys.length - 1];
          current[arrayKey] = [...current[arrayKey], defaultValue];

          return newData;
        });
      };

      const removeArrayItem = (arrayPath, index) => {
        setData(prev => {
          const newData = { ...prev };
          const keys = arrayPath.split('.');
          let current = newData;

          for (let i = 0; i < keys.length - 1; i++) {
            current[keys[i]] = { ...current[keys[i]] };
            current = current[keys[i]];
          }

          const arrayKey = keys[keys.length - 1];
          current[arrayKey] = current[arrayKey].filter((_, i) => i !== index);

          return newData;
        });
      };

      if (loading || !data) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="text-xl">{loading ? 'Loading...' : 'Failed to load data'}</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-100">
          {/* Header */}
          <header className="bg-white shadow-sm border-b sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
              <h1 className="text-2xl font-bold text-gray-900">Resume CMS Admin Panel</h1>
              <div className="flex gap-3">
                <button
                  onClick={() => window.open('index-editable.html', '_blank')}
                  className="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 flex items-center gap-2"
                >
                  <Eye size={20} /> Preview
                </button>
                <button
                  onClick={saveToLocalStorage}
                  className="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 flex items-center gap-2"
                >
                  <Save size={20} /> Save
                </button>
                <button
                  onClick={downloadJSON}
                  className="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 flex items-center gap-2"
                >
                  <Download size={20} /> Export JSON
                </button>
                <button
                  onClick={loadFromJSON}
                  className="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 flex items-center gap-2"
                >
                  <Upload size={20} /> Import JSON
                </button>
              </div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-6 py-8">
            {/* Section Tabs */}
            <div className="bg-white rounded-lg shadow-sm mb-6 p-2 flex gap-2 overflow-x-auto">
              {['personal', 'summary', 'skills', 'experience', 'projects', 'earlierExperience', 'education'].map(section => (
                <button
                  key={section}
                  onClick={() => setActiveSection(section)}
                  className={`px-4 py-2 rounded font-semibold whitespace-nowrap ${
                    activeSection === section
                      ? 'bg-blue-500 text-white'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {section.charAt(0).toUpperCase() + section.slice(1)}
                </button>
              ))}
            </div>

            {/* Content Sections */}
            <div className="bg-white rounded-lg shadow-sm p-6">
              {/* Personal Info */}
              {activeSection === 'personal' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Personal Information</h2>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Name</label>
                    <input
                      type="text"
                      value={data.personal.name}
                      onChange={(e) => updateField('personal.name', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                    <input
                      type="text"
                      value={data.personal.title}
                      onChange={(e) => updateField('personal.title', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
                    <input
                      type="text"
                      value={data.personal.subtitle}
                      onChange={(e) => updateField('personal.subtitle', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Phone</label>
                      <input
                        type="text"
                        value={data.personal.contact.phone}
                        onChange={(e) => updateField('personal.contact.phone', e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                      <input
                        type="email"
                        value={data.personal.contact.email}
                        onChange={(e) => updateField('personal.contact.email', e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Website</label>
                      <input
                        type="text"
                        value={data.personal.contact.website}
                        onChange={(e) => updateField('personal.contact.website', e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                  </div>
                </div>
              )}

              {/* Summary */}
              {activeSection === 'summary' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Professional Summary</h2>
                  <textarea
                    value={data.summary}
                    onChange={(e) => updateField('summary', e.target.value)}
                    rows={6}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>
              )}

              {/* Skills */}
              {activeSection === 'skills' && (
                <div className="space-y-6">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Skills</h2>

                  {/* Product Skills */}
                  <div className="border-l-4 border-blue-500 pl-4">
                    <h3 className="font-bold text-gray-900 mb-3">Product / PM Skills</h3>
                    {data.skills.product.map((skill, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <input
                          type="text"
                          value={skill}
                          onChange={(e) => updateArrayItem('skills.product', idx, e.target.value)}
                          className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                        <button
                          onClick={() => removeArrayItem('skills.product', idx)}
                          className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                        >
                          <Trash size={16} />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => addArrayItem('skills.product', 'New skill')}
                      className="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Skill
                    </button>
                  </div>

                  {/* Tech Skills */}
                  <div className="border-l-4 border-green-500 pl-4">
                    <h3 className="font-bold text-gray-900 mb-3">Tech & Tools</h3>
                    {data.skills.tech.map((skill, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <input
                          type="text"
                          value={skill}
                          onChange={(e) => updateArrayItem('skills.tech', idx, e.target.value)}
                          className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        />
                        <button
                          onClick={() => removeArrayItem('skills.tech', idx)}
                          className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                        >
                          <Trash size={16} />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => addArrayItem('skills.tech', 'New tool')}
                      className="mt-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Tool
                    </button>
                  </div>

                  {/* Soft Skills */}
                  <div className="border-l-4 border-purple-500 pl-4">
                    <h3 className="font-bold text-gray-900 mb-3">Soft Skills</h3>
                    {data.skills.soft.map((skill, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <input
                          type="text"
                          value={skill}
                          onChange={(e) => updateArrayItem('skills.soft', idx, e.target.value)}
                          className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                        <button
                          onClick={() => removeArrayItem('skills.soft', idx)}
                          className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                        >
                          <Trash size={16} />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => addArrayItem('skills.soft', 'New skill')}
                      className="mt-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Skill
                    </button>
                  </div>
                </div>
              )}

              {/* Experience */}
              {activeSection === 'experience' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Work Experience</h2>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Job Title</label>
                    <input
                      type="text"
                      value={data.experience.title}
                      onChange={(e) => updateField('experience.title', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Company</label>
                    <input
                      type="text"
                      value={data.experience.company}
                      onChange={(e) => updateField('experience.company', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Period</label>
                    <input
                      type="text"
                      value={data.experience.period}
                      onChange={(e) => updateField('experience.period', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>

                  <div className="mt-6">
                    <h3 className="font-bold text-gray-900 mb-3">Responsibilities</h3>
                    {data.experience.responsibilities.map((resp, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <textarea
                          value={resp}
                          onChange={(e) => updateArrayItem('experience.responsibilities', idx, e.target.value)}
                          rows={2}
                          className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                        <button
                          onClick={() => removeArrayItem('experience.responsibilities', idx)}
                          className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 h-fit"
                        >
                          <Trash size={16} />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => addArrayItem('experience.responsibilities', 'New responsibility')}
                      className="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Responsibility
                    </button>
                  </div>

                  <div className="mt-6">
                    <h3 className="font-bold text-gray-900 mb-3">Achievements</h3>
                    {data.experience.achievements.map((ach, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <textarea
                          value={ach}
                          onChange={(e) => updateArrayItem('experience.achievements', idx, e.target.value)}
                          rows={2}
                          className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        />
                        <button
                          onClick={() => removeArrayItem('experience.achievements', idx)}
                          className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 h-fit"
                        >
                          <Trash size={16} />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => addArrayItem('experience.achievements', 'New achievement')}
                      className="mt-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Achievement
                    </button>
                  </div>
                </div>
              )}

              {/* Note: Other sections follow similar pattern */}
              {activeSection === 'projects' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Projects</h2>
                  <p className="text-gray-600">Project editing interface would go here. For simplicity, edit projects via JSON export/import or inline editing mode.</p>
                </div>
              )}

              {activeSection === 'earlierExperience' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Earlier Experience</h2>
                  <p className="text-gray-600">Earlier experience editing would go here. Use JSON export/import for complex edits.</p>
                </div>
              )}

              {activeSection === 'education' && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold text-gray-900 mb-4">Education & Languages</h2>

                  <div className="border-l-4 border-blue-500 pl-4 mb-6">
                    <h3 className="font-bold text-gray-900 mb-3">Education</h3>
                    <div className="space-y-3">
                      <input
                        type="text"
                        value={data.education.school}
                        onChange={(e) => updateField('education.school', e.target.value)}
                        placeholder="School"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                      <input
                        type="text"
                        value={data.education.major}
                        onChange={(e) => updateField('education.major', e.target.value)}
                        placeholder="Major"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                      <input
                        type="text"
                        value={data.education.period}
                        onChange={(e) => updateField('education.period', e.target.value)}
                        placeholder="Period"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                  </div>

                  <div className="border-l-4 border-green-500 pl-4">
                    <h3 className="font-bold text-gray-900 mb-3">Languages</h3>
                    <div className="space-y-3">
                      <input
                        type="text"
                        value={data.languages.language}
                        onChange={(e) => updateField('languages.language', e.target.value)}
                        placeholder="Language"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      />
                      <input
                        type="text"
                        value={data.languages.level}
                        onChange={(e) => updateField('languages.level', e.target.value)}
                        placeholder="Level"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      />
                      <input
                        type="text"
                        value={data.languages.certification}
                        onChange={(e) => updateField('languages.certification', e.target.value)}
                        placeholder="Certification"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      />
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AdminPanel />);
  </script>
</body>
</html>
