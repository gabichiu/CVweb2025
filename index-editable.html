<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>邱詩家 - Resume (Editable)</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    [contenteditable="true"] {
      outline: 2px dashed #3b82f6;
      outline-offset: 2px;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    [contenteditable="true"]:hover {
      background-color: rgba(59, 130, 246, 0.05);
    }
    [contenteditable="true"]:focus {
      outline: 2px solid #3b82f6;
      background-color: rgba(59, 130, 246, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide icon components
    const ChevronDown = ({ size = 24, className = '' }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="chevron-down" className={className} style={{ width: size, height: size }}></i>;
    };

    const Mail = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="mail" style={{ width: size, height: size }}></i>;
    };

    const Phone = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="phone" style={{ width: size, height: size }}></i>;
    };

    const Globe = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="globe" style={{ width: size, height: size }}></i>;
    };

    const Edit = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="edit" style={{ width: size, height: size }}></i>;
    };

    const Save = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="save" style={{ width: size, height: size }}></i>;
    };

    const Download = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="download" style={{ width: size, height: size }}></i>;
    };

    const Upload = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="upload" style={{ width: size, height: size }}></i>;
    };

    const X = ({ size = 16 }) => {
      React.useEffect(() => {
        lucide.createIcons();
      });
      return <i data-lucide="x" style={{ width: size, height: size }}></i>;
    };

    // Editable component wrapper
    function Editable({ value, onChange, isEditing, className = '', tag = 'span', multiline = false }) {
      const ref = useRef(null);

      useEffect(() => {
        if (ref.current && ref.current.textContent !== value) {
          ref.current.textContent = value;
        }
      }, [value]);

      const handleBlur = (e) => {
        if (isEditing && onChange) {
          onChange(e.target.textContent);
        }
      };

      const Tag = tag;

      return (
        <Tag
          ref={ref}
          className={className}
          contentEditable={isEditing}
          suppressContentEditableWarning
          onBlur={handleBlur}
        >
          {value}
        </Tag>
      );
    }

    function FullResumeSite() {
      const [expandedProject, setExpandedProject] = useState(null);
      const [isEditing, setIsEditing] = useState(false);
      const [resumeData, setResumeData] = useState(null);
      const [loading, setLoading] = useState(true);

      // Load data from JSON or localStorage
      useEffect(() => {
        const loadData = async () => {
          // First check localStorage
          const savedData = localStorage.getItem('resumeData');
          if (savedData) {
            setResumeData(JSON.parse(savedData));
            setLoading(false);
            return;
          }

          // Otherwise load from JSON file
          try {
            const response = await fetch('resume-data.json');
            const data = await response.json();
            setResumeData(data);
          } catch (error) {
            console.error('Error loading resume data:', error);
            alert('Failed to load resume data. Please make sure resume-data.json is in the same folder.');
          }
          setLoading(false);
        };

        loadData();
      }, []);

      const saveToLocalStorage = () => {
        localStorage.setItem('resumeData', JSON.stringify(resumeData));
        alert('Changes saved to browser storage!');
      };

      const downloadJSON = () => {
        const dataStr = JSON.stringify(resumeData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'resume-data.json';
        link.click();
        URL.revokeObjectURL(url);
      };

      const loadFromJSON = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                setResumeData(data);
                localStorage.setItem('resumeData', JSON.stringify(data));
                alert('Data loaded successfully!');
              } catch (error) {
                alert('Error parsing JSON file: ' + error.message);
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      };

      const resetToOriginal = () => {
        if (confirm('Reset to original data from resume-data.json? This will discard all changes.')) {
          localStorage.removeItem('resumeData');
          window.location.reload();
        }
      };

      const updateData = (path, value) => {
        setResumeData(prev => {
          const newData = { ...prev };
          const keys = path.split('.');
          let current = newData;

          for (let i = 0; i < keys.length - 1; i++) {
            const key = keys[i];
            const arrayMatch = key.match(/(.+)\[(\d+)\]/);

            if (arrayMatch) {
              const arrayKey = arrayMatch[1];
              const index = parseInt(arrayMatch[2]);
              current = current[arrayKey][index];
            } else {
              current = current[key];
            }
          }

          const lastKey = keys[keys.length - 1];
          current[lastKey] = value;

          return newData;
        });
      };

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-xl">Loading...</div>
          </div>
        );
      }

      if (!resumeData) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-xl text-red-600">Failed to load resume data</div>
          </div>
        );
      }

      return (
        <div className="bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100 min-h-screen text-slate-900">
          {/* Edit Controls */}
          <div className="fixed top-4 right-4 z-50 flex gap-2">
            <button
              onClick={() => setIsEditing(!isEditing)}
              className={`px-4 py-2 rounded-lg font-semibold shadow-lg flex items-center gap-2 ${
                isEditing
                  ? 'bg-red-500 text-white hover:bg-red-600'
                  : 'bg-blue-500 text-white hover:bg-blue-600'
              }`}
            >
              {isEditing ? <><X size={16} /> Exit Edit Mode</> : <><Edit size={16} /> Edit Mode</>}
            </button>

            {isEditing && (
              <div className="flex gap-2">
                <button
                  onClick={saveToLocalStorage}
                  className="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold shadow-lg hover:bg-green-600 flex items-center gap-2"
                >
                  <Save size={16} /> Save
                </button>
                <button
                  onClick={downloadJSON}
                  className="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold shadow-lg hover:bg-purple-600 flex items-center gap-2"
                >
                  <Download size={16} /> Export
                </button>
                <button
                  onClick={loadFromJSON}
                  className="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold shadow-lg hover:bg-orange-600 flex items-center gap-2"
                >
                  <Upload size={16} /> Import
                </button>
                <button
                  onClick={resetToOriginal}
                  className="px-4 py-2 bg-slate-500 text-white rounded-lg font-semibold shadow-lg hover:bg-slate-600"
                >
                  Reset
                </button>
              </div>
            )}
          </div>

          {/* Header */}
          <header className="bg-white border-b-2 border-blue-500 sticky top-0 z-40 shadow-sm">
            <div className="max-w-7xl mx-auto px-6 py-6">
              <div className="flex justify-between items-start">
                <div>
                  <Editable
                    value={resumeData.personal.name}
                    onChange={(val) => updateData('personal.name', val)}
                    isEditing={isEditing}
                    className="text-4xl font-bold text-slate-900"
                    tag="h1"
                  />
                  <Editable
                    value={resumeData.personal.title}
                    onChange={(val) => updateData('personal.title', val)}
                    isEditing={isEditing}
                    className="text-blue-600 font-semibold mt-1 block"
                    tag="p"
                  />
                  <Editable
                    value={resumeData.personal.subtitle}
                    onChange={(val) => updateData('personal.subtitle', val)}
                    isEditing={isEditing}
                    className="text-sm text-slate-600 mt-2 block"
                    tag="p"
                  />
                </div>
                <div className="flex flex-col gap-2 text-right text-sm">
                  <a href={`tel:${resumeData.personal.contact.phone}`} className="flex items-center justify-end gap-2 text-slate-700 hover:text-blue-600">
                    <Phone size={16} />
                    <Editable
                      value={resumeData.personal.contact.phone}
                      onChange={(val) => updateData('personal.contact.phone', val)}
                      isEditing={isEditing}
                    />
                  </a>
                  <a href={`mailto:${resumeData.personal.contact.email}`} className="flex items-center justify-end gap-2 text-slate-700 hover:text-blue-600">
                    <Mail size={16} />
                    <Editable
                      value={resumeData.personal.contact.email}
                      onChange={(val) => updateData('personal.contact.email', val)}
                      isEditing={isEditing}
                    />
                  </a>
                  <a href={resumeData.personal.contact.website} className="flex items-center justify-end gap-2 text-slate-700 hover:text-blue-600">
                    <Globe size={16} />
                    <Editable
                      value={resumeData.personal.contact.website}
                      onChange={(val) => updateData('personal.contact.website', val)}
                      isEditing={isEditing}
                    />
                  </a>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-6 py-12 space-y-12">

            {/* Professional Summary */}
            <section className="bg-white rounded-lg shadow-md p-8 border-l-4 border-blue-500">
              <h2 className="text-2xl font-bold text-slate-900 mb-4">Professional Summary | 專業摘要</h2>
              <Editable
                value={resumeData.summary}
                onChange={(val) => updateData('summary', val)}
                isEditing={isEditing}
                className="text-slate-700 leading-relaxed text-base block"
                tag="p"
              />
            </section>

            {/* Skills Section - simplified for editing */}
            <section>
              <h2 className="text-2xl font-bold text-slate-900 mb-6">Skills | 專業技能</h2>

              {/* Product / PM Skills */}
              <div className="bg-white rounded-lg shadow-md p-8 mb-6 border-l-4 border-blue-500">
                <h3 className="text-xl font-bold text-slate-900 mb-4 pb-2 border-b-2 border-blue-300">
                  Product / PM Skills
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {resumeData.skills.product.map((skill, idx) => (
                    <div key={idx} className="flex items-start">
                      <span className="text-blue-500 mr-3 mt-1">▸</span>
                      <Editable
                        value={skill}
                        onChange={(val) => {
                          const newSkills = [...resumeData.skills.product];
                          newSkills[idx] = val;
                          setResumeData({...resumeData, skills: {...resumeData.skills, product: newSkills}});
                        }}
                        isEditing={isEditing}
                        className="text-slate-700"
                      />
                    </div>
                  ))}
                </div>
              </div>

              {/* Tech & Tools */}
              <div className="bg-white rounded-lg shadow-md p-8 mb-6 border-l-4 border-green-500">
                <h3 className="text-xl font-bold text-slate-900 mb-4 pb-2 border-b-2 border-green-300">
                  Tech & Tools
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {resumeData.skills.tech.map((skill, idx) => (
                    <div key={idx} className="flex items-start">
                      <span className="text-green-500 mr-3 mt-1">▸</span>
                      <Editable
                        value={skill}
                        onChange={(val) => {
                          const newSkills = [...resumeData.skills.tech];
                          newSkills[idx] = val;
                          setResumeData({...resumeData, skills: {...resumeData.skills, tech: newSkills}});
                        }}
                        isEditing={isEditing}
                        className="text-slate-700"
                      />
                    </div>
                  ))}
                </div>
              </div>

              {/* Soft Skills */}
              <div className="bg-white rounded-lg shadow-md p-8 border-l-4 border-purple-500">
                <h3 className="text-xl font-bold text-slate-900 mb-4 pb-2 border-b-2 border-purple-300">
                  Soft Skills
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {resumeData.skills.soft.map((skill, idx) => (
                    <div key={idx} className="flex items-start">
                      <span className="text-purple-500 mr-3 mt-1">▸</span>
                      <Editable
                        value={skill}
                        onChange={(val) => {
                          const newSkills = [...resumeData.skills.soft];
                          newSkills[idx] = val;
                          setResumeData({...resumeData, skills: {...resumeData.skills, soft: newSkills}});
                        }}
                        isEditing={isEditing}
                        className="text-slate-700"
                      />
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* Work Experience */}
            <section>
              <h2 className="text-2xl font-bold text-slate-900 mb-6">Work Experience | 工作經驗</h2>

              <div className="bg-white rounded-lg shadow-md border-l-4 border-blue-500 overflow-hidden">
                <div className="p-8">
                  <div className="flex justify-between items-start mb-6">
                    <div>
                      <Editable
                        value={resumeData.experience.title}
                        onChange={(val) => updateData('experience.title', val)}
                        isEditing={isEditing}
                        className="text-xl font-bold text-slate-900"
                        tag="h3"
                      />
                      <Editable
                        value={resumeData.experience.company}
                        onChange={(val) => updateData('experience.company', val)}
                        isEditing={isEditing}
                        className="text-blue-600 font-semibold mt-1 block"
                        tag="p"
                      />
                      <Editable
                        value={resumeData.experience.period}
                        onChange={(val) => updateData('experience.period', val)}
                        isEditing={isEditing}
                        className="text-sm text-slate-600 mt-1 block"
                        tag="p"
                      />
                    </div>
                  </div>

                  {/* Core Responsibilities */}
                  <div className="mb-8">
                    <h4 className="font-bold text-slate-900 mb-4 flex items-center pb-2 border-b-2 border-blue-300">
                      <span className="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">→</span>
                      核心職責
                    </h4>
                    <ul className="ml-7 space-y-3">
                      {resumeData.experience.responsibilities.map((item, idx) => (
                        <li key={idx} className="text-slate-700 flex items-start">
                          <span className="text-blue-500 mr-2">•</span>
                          <Editable
                            value={item}
                            onChange={(val) => {
                              const newResp = [...resumeData.experience.responsibilities];
                              newResp[idx] = val;
                              setResumeData({...resumeData, experience: {...resumeData.experience, responsibilities: newResp}});
                            }}
                            isEditing={isEditing}
                          />
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Key Achievements */}
                  <div>
                    <h4 className="font-bold text-slate-900 mb-4 flex items-center pb-2 border-b-2 border-green-300">
                      <span className="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">✓</span>
                      主要成果
                    </h4>
                    <ul className="ml-7 space-y-3">
                      {resumeData.experience.achievements.map((item, idx) => (
                        <li key={idx} className="text-slate-700 flex items-start">
                          <span className="text-green-500 mr-2">✓</span>
                          <Editable
                            value={item}
                            onChange={(val) => {
                              const newAch = [...resumeData.experience.achievements];
                              newAch[idx] = val;
                              setResumeData({...resumeData, experience: {...resumeData.experience, achievements: newAch}});
                            }}
                            isEditing={isEditing}
                          />
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            </section>

            {/* Note: Projects section follows similar pattern - truncated for brevity */}
            {/* In production, you'd extend the Editable pattern to all sections */}

            {/* Earlier Experience */}
            <section>
              <h2 className="text-2xl font-bold text-slate-900 mb-6">Earlier Experience | 早期經驗</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {resumeData.earlierExperience.map((exp, idx) => (
                  <div key={idx} className="bg-white rounded-lg shadow-md p-6 border-l-4 border-slate-300">
                    <Editable
                      value={exp.title}
                      onChange={(val) => {
                        const newExp = [...resumeData.earlierExperience];
                        newExp[idx] = {...newExp[idx], title: val};
                        setResumeData({...resumeData, earlierExperience: newExp});
                      }}
                      isEditing={isEditing}
                      className="font-bold text-slate-900"
                      tag="h3"
                    />
                    <Editable
                      value={exp.company}
                      onChange={(val) => {
                        const newExp = [...resumeData.earlierExperience];
                        newExp[idx] = {...newExp[idx], company: val};
                        setResumeData({...resumeData, earlierExperience: newExp});
                      }}
                      isEditing={isEditing}
                      className="text-slate-600 text-sm mt-1 block"
                      tag="p"
                    />
                    <Editable
                      value={exp.period}
                      onChange={(val) => {
                        const newExp = [...resumeData.earlierExperience];
                        newExp[idx] = {...newExp[idx], period: val};
                        setResumeData({...resumeData, earlierExperience: newExp});
                      }}
                      isEditing={isEditing}
                      className="text-slate-500 text-xs mt-1 block"
                      tag="p"
                    />
                    <Editable
                      value={exp.description}
                      onChange={(val) => {
                        const newExp = [...resumeData.earlierExperience];
                        newExp[idx] = {...newExp[idx], description: val};
                        setResumeData({...resumeData, earlierExperience: newExp});
                      }}
                      isEditing={isEditing}
                      className="text-slate-700 mt-3 text-sm block"
                      tag="p"
                    />
                  </div>
                ))}
              </div>
            </section>

          </main>

          {/* Footer */}
          <footer className="border-t border-slate-200 bg-white mt-12">
            <div className="max-w-7xl mx-auto px-6 py-8 text-center text-sm text-slate-600">
              <Editable
                value={resumeData.footer.tagline}
                onChange={(val) => updateData('footer.tagline', val)}
                isEditing={isEditing}
                tag="p"
              />
              <Editable
                value={resumeData.footer.contact}
                onChange={(val) => updateData('footer.contact', val)}
                isEditing={isEditing}
                className="mt-2 text-xs text-slate-500 block"
                tag="p"
              />
            </div>
          </footer>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FullResumeSite />);
  </script>
</body>
</html>
